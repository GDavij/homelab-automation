---
# ==============================================================================
# Database Management Role - PostgreSQL Sub-Role Variables
# ==============================================================================
# PostgreSQL 16 (official image) with pgvector extension installed via script
# Port: 5432 (PostgreSQL server)
# Access: Tailnet only (100.64.0.0/10)
# See: docs/ENVIRONMENT_VARIABLES.md#postgresql-sub-role
# See: docs/POSTGRES_DATABASE_MANAGEMENT.md for usage guide
# ==============================================================================

# ------------------------------------------------------------------------------
# Version Configuration
# ------------------------------------------------------------------------------
POSTGRESQL_VERSION: "16-alpine"  # Official postgres Docker image tag
PGVECTOR_VERSION: "0.7.4"        # pgvector extension version to install

# ------------------------------------------------------------------------------
# Storage Configuration
# ------------------------------------------------------------------------------
# All paths under COLD_STORAGE_PATH for persistent data
POSTGRESQL_DATA_PATH: "{{ COLD_STORAGE_PATH }}/database/postgresql/data"      # PGDATA directory
POSTGRESQL_INIT_PATH: "{{ COLD_STORAGE_PATH }}/database/postgresql/init"      # Init SQL scripts
POSTGRESQL_CONF_PATH: "{{ COLD_STORAGE_PATH }}/database/postgresql/conf"      # postgresql.conf, pg_hba.conf
POSTGRESQL_BACKUP_PATH: "{{ COLD_STORAGE_PATH }}/database/postgresql/backup"  # Automated backups
POSTGRESQL_LOGS_PATH: "{{ COLD_STORAGE_PATH }}/database/postgresql/logs"      # PostgreSQL logs

# ------------------------------------------------------------------------------
# Network Configuration
# ------------------------------------------------------------------------------
POSTGRESQL_PORT: 5432  # PostgreSQL server port

# ------------------------------------------------------------------------------
# Performance Configuration
# ------------------------------------------------------------------------------
# Optimized for 16GB RAM server running multiple services
# RAM Usage: ~600MB idle, ~800-1000MB light load, ~1.5GB heavy load (50 connections)
POSTGRES_SHARED_BUFFERS: "512MB"            # RAM allocated to PostgreSQL cache (~3% of 16GB)
POSTGRES_EFFECTIVE_CACHE_SIZE: "4GB"        # OS cache hint (not allocated, ~25% of RAM)
POSTGRES_MAX_CONNECTIONS: 50                # Maximum concurrent connections
POSTGRES_WORK_MEM: "8MB"                    # Memory per query operation (sort, hash)
POSTGRES_MAINTENANCE_WORK_MEM: "256MB"      # Memory for VACUUM, CREATE INDEX

# ------------------------------------------------------------------------------
# Admin Configuration
# ------------------------------------------------------------------------------
POSTGRES_ADMIN_USER: "root"  # Admin username with CREATEDB, CREATEROLE privileges
POSTGRES_ADMIN_EMAIL: "admin@example.com"  # Admin email for documentation
# Passwords stored in database-management/postgres/secrets.yml:
#   - POSTGRES_ROOT_PASSWORD (postgres superuser)
#   - POSTGRES_ADMIN_PASSWORD (dbadmin_autogen user)

# ------------------------------------------------------------------------------
# Backup Configuration
# ------------------------------------------------------------------------------
POSTGRES_BACKUP_SCHEDULE: "0 2 * * *"       # Cron schedule (daily at 2 AM)
POSTGRES_BACKUP_RETENTION_DAILY: 7          # Keep daily backups for 7 days
POSTGRES_BACKUP_RETENTION_WEEKLY: 30        # Keep weekly backups for 30 days
POSTGRES_BACKUP_RETENTION_MONTHLY: 365      # Keep monthly backups for 1 year
POSTGRES_BACKUP_ENABLE_ENCRYPTION: false    # Encrypt backups with GPG (requires GPG_RECIPIENT)
POSTGRES_BACKUP_GPG_RECIPIENT: ""           # GPG key ID for backup encryption

# ------------------------------------------------------------------------------
# Security Configuration
# ------------------------------------------------------------------------------
POSTGRES_ENABLE_SSL: false  # Enable SSL/TLS (disabled: Tailscale provides encryption)
POSTGRES_SSL_MODE: "disable"  # SSL mode: disable, allow, prefer, require, verify-ca, verify-full

# ------------------------------------------------------------------------------
# Logging Configuration
# ------------------------------------------------------------------------------
POSTGRES_LOG_STATEMENT: "none"  # Log SQL statements: none, ddl, mod, all
POSTGRES_LOG_DURATION: "off"    # Log query duration: on, off

# ------------------------------------------------------------------------------
# Database Definitions
# ------------------------------------------------------------------------------
# Define your databases here or in database-management/postgres/secrets.yml
# See: docs/POSTGRES_DATABASE_MANAGEMENT.md#database-definitions for schema

# Start with empty list - add databases as needed
POSTGRES_DATABASES: []

# Example:
# POSTGRES_DATABASES:
#   - name: langfuse_db
#     owner: langfuse_user
#     description: "Langfuse AI observability database"
#     encoding: UTF8
#     locale: en_US.UTF-8
#     connection_limit: 50
#     allowed_users: []              # Additional users with full access
#     readonly_users: []             # Users with SELECT-only access
#     enable_pgvector: true          # Enable vector similarity search
#     enable_uuid: true              # Enable UUID generation
#     enable_audit_log: false        # Create audit_log table

# ------------------------------------------------------------------------------
# User Definitions
# ------------------------------------------------------------------------------
# Define your database users in database-management/postgres/secrets.yml for security
# See: docs/POSTGRES_DATABASE_MANAGEMENT.md#user-definitions for schema

# Start with empty list - add users as needed
POSTGRES_DATABASE_USERS: [ ]
#
# Example (in postgres/secrets.yml):
# POSTGRES_DATABASE_USERS:
#   - username: langfuse_user
#     password: "{{ LANGFUSE_DB_PASSWORD }}"  # Reference password from secrets.yml
#     is_superuser: false
#     can_create_db: false
#     can_create_role: false
#     connection_limit: 10


# ==============================================================================
# Connection Information
# ==============================================================================
# - Connection string: postgresql://user:password@{{ TAILSCALE_IP_ADDRESS }}:5432/database
# - Admin connection: psql "postgresql://db_admin:PASSWORD@{{ TAILSCALE_IP_ADDRESS }}:5432/postgres"
# - pgAdmin UI: See database-management/pgadmin/vars.yml
# ==============================================================================
