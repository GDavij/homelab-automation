---
# ==============================================================================
# Database Management Role - Internal Variables
# ==============================================================================
# These are computed/internal variables used by the database-management role
# 
# ⚠️ WARNING: DO NOT EDIT THIS FILE ⚠️
# These values are automatically computed from variables in sub-role folders
# Override values in postgres/vars.yml, pgadmin/vars.yml, or secrets.yml instead
#
# See: docs/ENVIRONMENT_VARIABLES.md#database-internal-variables
# ==============================================================================

# ==============================================================================
# DOCKER IMAGE CONFIGURATION
# ==============================================================================
# Computed from version variables in postgres/vars.yml and pgadmin/vars.yml

# PostgreSQL Sub-Role Images
POSTGRESQL_IMAGE: "postgres:{{ POSTGRESQL_VERSION }}"
PGADMIN_IMAGE: "dpage/pgadmin4:{{ PGADMIN_VERSION }}"

# pgAdmin Profile (for Docker Compose conditional deployment)
PGADMIN_PROFILE: "pgadmin"


# ==============================================================================
# PROJECT CONFIGURATION
# ==============================================================================
# Follows pattern from other roles (comfyui, nginx-manager, etc.)

# Project Directory
DATABASE_MANAGEMENT_PROJECT_DIR: "/tmp/database-management"

# Environment Files
DATABASE_MANAGEMENT_ENV_FILE: ".env"                          # Main environment file
DATABASE_MANAGEMENT_POSTGRES_ENV_FILE: ".postgresql.env"     # PostgreSQL bootstrap credentials
DATABASE_MANAGEMENT_PGADMIN_ENV_FILE: ".pgadmin.env"         # pgAdmin credentials


# ==============================================================================
# HEALTH CHECK CONFIGURATION
# ==============================================================================
# Docker health check settings for PostgreSQL container

DATABASE_MANAGEMENT_HEALTHCHECK_RETRIES: 12  # Maximum health check attempts
DATABASE_MANAGEMENT_HEALTHCHECK_DELAY: 5     # Seconds between attempts (total: 60s max)


# ==============================================================================
# BACKUP CONFIGURATION
# ==============================================================================
# Internal backup script settings

# Backup Script Location
DATABASE_MANAGEMENT_BACKUP_SCRIPT: "/usr/local/bin/postgresql-backup.sh"

# Backup Cron Configuration (parsed from POSTGRES_BACKUP_SCHEDULE)
POSTGRES_BACKUP_CRON_MINUTE: "{{ POSTGRES_BACKUP_SCHEDULE.split(' ')[0] }}"
POSTGRES_BACKUP_CRON_HOUR: "{{ POSTGRES_BACKUP_SCHEDULE.split(' ')[1] }}"
POSTGRES_BACKUP_CRON_USER: "root"

# Backup Retention Aliases (for backward compatibility)
POSTGRES_BACKUP_RETENTION_DAYS: "{{ POSTGRES_BACKUP_RETENTION_DAILY }}"
POSTGRES_BACKUP_RETENTION_WEEKS: "{{ POSTGRES_BACKUP_RETENTION_WEEKLY }}"
POSTGRES_BACKUP_RETENTION_MONTHS: "{{ POSTGRES_BACKUP_RETENTION_MONTHLY }}"


# ==============================================================================
# NETWORK CONFIGURATION
# ==============================================================================
# Internal Docker network settings

DATABASE_MANAGEMENT_INTERNAL_NETWORK: "self-hosted"  # Docker network name (shared with other services)


# ==============================================================================
# COMPUTED PATHS
# ==============================================================================
# Paths computed from base paths in postgres/vars.yml

# PostgreSQL Certificate Path (for SSL/TLS)
POSTGRESQL_CERTS_PATH: "{{ POSTGRESQL_CONF_PATH }}/certs"


# ==============================================================================
# END OF INTERNAL VARIABLES
# ==============================================================================
# To modify configuration, edit:
#   - database-management/engine.yml (engine selection)
#   - database-management/postgres/vars.yml (PostgreSQL config)
#   - database-management/postgres/secrets.yml (PostgreSQL passwords)
#   - database-management/pgadmin/vars.yml (pgAdmin config)
#   - database-management/pgadmin/secrets.yml (pgAdmin passwords)
#
# To view all variables, see: docs/ENVIRONMENT_VARIABLES.md
# ==============================================================================
